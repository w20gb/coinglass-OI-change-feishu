# 币安持仓异动监控 (Binance Open Interest Monitor) - 需求文档

## 1. 项目概述 (Overview)
本项目旨在通过实时监控币安 (Binance) 合约交易对的 **持仓量 (Open Interest, OI)** 变化，及时捕捉大资金异动与潜在行情爆发点。持仓量的剧烈增加通常伴随多空博弈加剧，是大行情启动的重要先行指标。

## 2. 核心功能 (Core Features)

### 2.1 高频监控机制
- **数据源**: Coinglass (通过 Playwright 头版注入 JS 劫持 WebSocket/XHR 数据流)。
- **监控范围**: 币安 USDT 本位永续合约 (全币种)。
- **触发逻辑**:
    - 定时比较本次抓取数据与上次快照数据。
    - 若 **持仓量变化幅度 (OI Change %)** 超过设定阈值，即刻生成告警。

### 2.2 智能过滤与去噪
- **异常值过滤**:
    - 自动剔除涨跌幅异常 (如数据源错误的 ±999%) 或未开盘币种。

### 2.3 飞书实时推送 (Feishu Alert)
- **卡片消息**:
    - 包含: 币种名称, 持仓变化幅度 (如 +15%), 当前总持仓量 (OI Value), 对应价格。
    - 趋势符号: 🚀 (持仓激增) / 📉 (持仓锐减)。
    - **直达链接**: 点击币种名称直接跳转 Coinglass K线页面。
- **汇总机制**: 一次推送所有满足条件的币种列表，避免消息轰炸。

## 3. 技术架构 (Technical Architecture)

- **语言**: Python 3.10+
- **核心库**:
    - `playwright`: 无头浏览器自动化 (Headless Browser)，用于绕过 Cloudflare 及动态加载。
    - `asyncio`: 异步并发控制。
- **数据存储**: 本地 JSON 文件 (`history_oi.json`)，轻量级存储上次状态。
- **反爬策略**:
    - 注入 `JSON.parse` 劫持脚本，直接获取前端渲染前的原始数据对象，规避 DOM 解析的不稳定性。
    - 模拟真实用户行为 (User-Agent, Viewport)。

## 4. 配置文件设计 (Config Structure)

`config.json` 示例：
```json
{
    "feishu_webhook": "YOUR_WEBHOOK_URL",
    "monitor_settings": {
        "interval_seconds": 300,        // 检查间隔 (5分钟)
        "oi_change_threshold": 0.05,    // 持仓变化阈值 (5%)
        "min_oi_usdt": 0,               // 最小持仓量 (0 = 不限制)
        "cooldown_minutes": 0           // 冷却时间 (0 = 不限制)
    },
    "filter_settings": {
        "exclude_symbols": ["USDCUSDT", "BUSDUSDT"] // 排除稳定币
    }
}
```

## 5. 交付物清单 (Deliverables)

1.  `main.py`: 核心监控脚本。
2.  `config.json`: 配置文件模板。
3.  `requirements.txt`: 依赖库清单。
4.  `一键启动.bat`: Windows 环境下的一键运行脚本 (含环境检测)。
5.  `README.md`: 使用说明。

## 6. 参考项目
-  `H:\MyCode\BTC\币安全币种行情异动监控\价格异动监控` (架构复用)
